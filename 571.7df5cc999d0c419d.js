"use strict";(self.webpackChunkmy_finance_front=self.webpackChunkmy_finance_front||[]).push([[571],{8571:(it,g,u)=>{u.r(g),u.d(g,{ContaMensalModule:()=>st});var b=u(9032),m=u(467),d=u(2572),t=u(540),_=u(7794),C=u(7008),p=u(177),c=u(4341);function F(a,r){if(1&a){const e=t.RV6();t.j41(0,"div",24)(1,"input",25),t.bIt("change",function(n){const i=t.eBV(e).$implicit,l=t.XpG();return t.Njj(l.toggleMulti("name",i,n.target.checked))}),t.k0s(),t.j41(2,"label",26),t.EFF(3),t.k0s()()}if(2&a){const e=r.$implicit,o=t.XpG();t.R7$(1),t.Y8G("id","conta_"+e)("checked",o.isSelected("name",e)),t.R7$(1),t.Y8G("for","conta_"+e),t.R7$(1),t.JRh(e)}}function y(a,r){if(1&a){const e=t.RV6();t.j41(0,"div",24)(1,"input",25),t.bIt("change",function(n){const i=t.eBV(e).$implicit,l=t.XpG();return t.Njj(l.toggleMulti("categoryName",i,n.target.checked))}),t.k0s(),t.j41(2,"label",26),t.EFF(3),t.k0s()()}if(2&a){const e=r.$implicit,o=t.XpG();t.R7$(1),t.Y8G("id","cat_"+e)("checked",o.isSelected("categoryName",e)),t.R7$(1),t.Y8G("for","cat_"+e),t.R7$(1),t.JRh(e)}}function w(a,r){if(1&a){const e=t.RV6();t.j41(0,"div",24)(1,"input",25),t.bIt("change",function(n){const i=t.eBV(e).$implicit,l=t.XpG();return t.Njj(l.toggleMulti("status",i,n.target.checked))}),t.k0s(),t.j41(2,"label",26),t.EFF(3),t.k0s()()}if(2&a){const e=r.$implicit,o=t.XpG();t.R7$(1),t.Y8G("id","st_"+e)("checked",o.isSelected("status",e)),t.R7$(1),t.Y8G("for","st_"+e),t.R7$(1),t.JRh(e)}}function E(a,r){1&a&&(t.j41(0,"tr")(1,"td",27),t.EFF(2,"Carregando..."),t.k0s()())}function T(a,r){1&a&&(t.j41(0,"tr")(1,"td",27),t.EFF(2," Nenhuma transa\xe7\xe3o encontrada com os filtros aplicados. "),t.k0s()())}function M(a,r){if(1&a){const e=t.RV6();t.qex(0),t.j41(1,"div",41)(2,"span",42),t.EFF(3),t.k0s(),t.j41(4,"button",43),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2).$implicit,s=t.XpG();return t.Njj(s.unlock.emit(n.id))}),t.EFF(5," \u{1f513} "),t.k0s()(),t.bVm()}if(2&a){const e=t.XpG(2).$implicit;t.R7$(2),t.Y8G("ngClass","PAGO NO PRAZO"===e.status?"badge bg-green-lt text-green-lt-fg":"AGUARDANDO"===e.status?"badge bg-yellow-lt text-red-lt-fg":"badge bg-red-lt text-red-lt-fg"),t.R7$(1),t.SpI(" \u{1f512} ",e.status," ")}}function R(a,r){if(1&a&&(t.j41(0,"option",46),t.EFF(1),t.k0s()),2&a){const e=r.$implicit;t.Y8G("ngValue",e),t.R7$(1),t.JRh(e)}}function I(a,r){if(1&a){const e=t.RV6();t.j41(0,"select",44),t.bIt("change",function(){t.eBV(e);const n=t.XpG(2).$implicit,s=t.XpG();return t.Njj(s.commitStatus(n.id))}),t.DNE(1,R,2,2,"option",45),t.k0s()}if(2&a){const e=t.XpG(2).$implicit,o=t.XpG();t.Y8G("disabled",o.isLocked(e.id)),t.R7$(1),t.Y8G("ngForOf",o.statusOptions)}}function S(a,r){if(1&a){const e=t.RV6();t.j41(0,"tr",29)(1,"td",30)(2,"input",6),t.bIt("change",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG();return t.Njj(s.toggleRow.emit(n.id))}),t.k0s()(),t.j41(3,"td",31),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td")(8,"div",32)(9,"span",33),t.EFF(10,"R$"),t.k0s(),t.j41(11,"input",34),t.bIt("focus",function(n){return n.target.select()})("input",function(n){t.eBV(e);const s=t.XpG().$implicit,i=t.XpG();return t.Njj(i.maskValueTyping(s.id,n))})("blur",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG();return t.Njj(s.commitValue(n.id))}),t.k0s()()(),t.j41(12,"td")(13,"input",35),t.bIt("blur",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG();return t.Njj(s.commitDate(n.id))}),t.k0s()(),t.j41(14,"td"),t.DNE(15,M,6,2,"ng-container",36),t.DNE(16,I,2,2,"ng-template",null,37,t.C5r),t.k0s(),t.j41(18,"td",30)(19,"div",38)(20,"button",39),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG();return t.Njj(s.saveRow.emit(n.id))}),t.EFF(21," \u{1f4be} "),t.k0s(),t.j41(22,"button",40),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,s=t.XpG();return t.Njj(s.deleteRow.emit(n.id))}),t.EFF(23," \u{1f5d1}\ufe0f "),t.k0s()()()()}if(2&a){const e=r.ngIf,o=t.sdS(17),n=t.XpG().$implicit,s=t.XpG();t.AVh("opacity-75",s.isLocked(n.id)),t.Y8G("formGroup",e),t.R7$(2),t.Y8G("checked",s.selectedIds.has(n.id)),t.R7$(2),t.JRh(n.name),t.R7$(2),t.JRh(n.categoryName),t.R7$(5),t.Y8G("disabled",s.isLocked(n.id))("readonly",s.isLocked(n.id)),t.R7$(2),t.Y8G("disabled",s.isLocked(n.id))("readonly",s.isLocked(n.id)),t.R7$(2),t.Y8G("ngIf",s.isLocked(n.id))("ngIfElse",o),t.R7$(5),t.Y8G("disabled",s.isLocked(n.id))}}function j(a,r){if(1&a&&(t.qex(0),t.DNE(1,S,24,13,"tr",28),t.bVm()),2&a){const e=r.$implicit,o=t.XpG();t.R7$(1),t.Y8G("ngIf",o.rowForms.get(e.id))}}let $=(()=>{class a{money(e){return(0,d.XZ)(e)}dateInput(e){return(0,d.E4)(e)}isLocked(e){return this.lockedById.get(e)??!1}constructor(e){this.fb=e,this.rows=[],this.loading=!1,this.lockedById=new Map,this.selectedIds=new Set,this.allVisibleSelected=!1,this.columnFilters={},this.statusOptions=[],this.toggleSelectAllVisible=new t.bkB,this.toggleRow=new t.bkB,this.columnFiltersChange=new t.bkB,this.changeField=new t.bkB,this.unlock=new t.bkB,this.saveRow=new t.bkB,this.deleteRow=new t.bkB,this.rowForms=new Map,this.ddContaOpen=!1,this.ddCategoriaOpen=!1,this.ddStatusOpen=!1,this.contaOptions=[],this.categoriaOptions=[]}ngOnChanges(e){if(this.columnFilters={name:Array.isArray(this.columnFilters?.name)?this.columnFilters.name:[],categoryName:Array.isArray(this.columnFilters?.categoryName)?this.columnFilters.categoryName:[],status:Array.isArray(this.columnFilters?.status)?this.columnFilters.status:[],value:this.columnFilters?.value??"",date:this.columnFilters?.date??""},e.rows){this.contaOptions=Array.from(new Set((this.rows??[]).map(n=>(n.name??"").trim()).filter(Boolean))).sort((n,s)=>n.localeCompare(s)),this.categoriaOptions=Array.from(new Set((this.rows??[]).map(n=>(n.categoryName??"").trim()).filter(Boolean))).sort((n,s)=>n.localeCompare(s));for(const n of this.rows){let s=this.rowForms.get(n.id);s?(s.controls.value.dirty||s.controls.value.setValue(this.money(n.value),{emitEvent:!1}),s.controls.date.dirty||s.controls.date.setValue(this.dateInput(n.date),{emitEvent:!1}),s.controls.status.dirty||s.controls.status.setValue(String(n.status??""),{emitEvent:!1})):(s=this.fb.group({value:this.fb.control(this.money(n.value),{nonNullable:!0}),date:this.fb.control(this.dateInput(n.date),{nonNullable:!0}),status:this.fb.control(String(n.status??""),{nonNullable:!0})}),this.rowForms.set(n.id,s))}const o=new Set(this.rows.map(n=>n.id));for(const n of Array.from(this.rowForms.keys()))o.has(n)||this.rowForms.delete(n)}}onDocClick(){this.ddContaOpen=!1,this.ddCategoriaOpen=!1,this.ddStatusOpen=!1}toggleDropdown(e,o){o.stopPropagation(),this.ddContaOpen="conta"===e&&!this.ddContaOpen,this.ddCategoriaOpen="categoria"===e&&!this.ddCategoriaOpen,this.ddStatusOpen="status"===e&&!this.ddStatusOpen}setColumnFilter(e,o){this.columnFiltersChange.emit({[e]:o})}isSelected(e,o){const n=this.columnFilters[e];return!!Array.isArray(n)&&n.includes(o)}toggleMulti(e,o,n){const s=Array.isArray(this.columnFilters[e])?[...this.columnFilters[e]]:[],i=n?Array.from(new Set([...s,o])):s.filter(l=>l!==o);this.setColumnFilter(e,i)}clearMulti(e){this.setColumnFilter(e,[])}multiLabel(e,o){const n=this.columnFilters[e],s=Array.isArray(n)?n.length:0;return s?1===s?`${o}: ${n[0]}`:`${o}: ${s} selecionados`:`${o}: Todos`}trackById(e,o){return o.id}maskValueTyping(e,o){const n=this.rowForms.get(e);if(!n)return;const s=o.target;let l=(s.value??"").replace(/\D/g,"");if(!l)return n.controls.value.setValue("",{emitEvent:!1}),void(s.value="");l=l.replace(/^0+/,""),l||(l="0");const h=l.padStart(3,"0"),v=h.slice(0,-2),at=h.slice(-2),f=`${v.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${at}`;n.controls.value.setValue(f,{emitEvent:!1}),s.value=f;const k=f.length;s.setSelectionRange(k,k)}commitValue(e){const o=this.rowForms.get(e);o&&(this.changeField.emit({id:e,field:"value",value:o.controls.value.value}),o.controls.value.markAsPristine())}commitDate(e){const o=this.rowForms.get(e);o&&(this.changeField.emit({id:e,field:"date",value:o.controls.date.value}),o.controls.date.markAsPristine())}commitStatus(e){const o=this.rowForms.get(e);o&&(this.changeField.emit({id:e,field:"status",value:o.controls.status.value}),o.controls.status.markAsPristine())}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(c.ok))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-conta-mensal-list"]],hostBindings:function(o,n){1&o&&t.bIt("click",function(){return n.onDocClick()},!1,t.EBC)},inputs:{rows:"rows",loading:"loading",lockedById:"lockedById",selectedIds:"selectedIds",allVisibleSelected:"allVisibleSelected",columnFilters:"columnFilters",statusOptions:"statusOptions"},outputs:{toggleSelectAllVisible:"toggleSelectAllVisible",toggleRow:"toggleRow",columnFiltersChange:"columnFiltersChange",changeField:"changeField",unlock:"unlock",saveRow:"saveRow",deleteRow:"deleteRow"},features:[t.OA$],decls:66,vars:27,consts:[[1,"card"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-vcenter","table-hover","mb-0"],[1,"bg-body-tertiary","bg-body","sticky-top"],[1,"text-center",2,"width","44px"],["type","checkbox",3,"checked","change"],[1,"text-nowrap"],[1,"text-nowrap",2,"width","160px"],[1,"text-nowrap",2,"width","170px"],[1,"text-nowrap",2,"width","190px"],[1,"text-center",2,"width","140px"],[1,"dropdown"],["type","button",1,"form-select","form-select-sm","text-start",3,"click"],[1,"dropdown-menu","p-2","w-100",2,"max-height","240px","overflow","auto",3,"click"],["class","form-check",4,"ngFor","ngForOf"],[1,"d-flex","gap-2","mt-2"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-sm","btn-primary","ms-auto",3,"click"],["placeholder",">= 100 (ou texto)",1,"form-control","form-control-sm",2,"width","120px",3,"value","input"],["type","date",1,"form-control","form-control-sm",3,"value","input"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-3","text-muted","small"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"],["colspan","7",1,"text-center","text-secondary","py-4"],[3,"formGroup","opacity-75",4,"ngIf"],[3,"formGroup"],[1,"text-center"],[1,"text-uppercase","fw-medium"],[1,"input-group","input-group-sm"],[1,"input-group-text"],["type","text","formControlName","value",1,"form-control",3,"disabled","readonly","focus","input","blur"],["type","date","formControlName","date",1,"form-control","form-control-sm",3,"disabled","readonly","blur"],[4,"ngIf","ngIfElse"],["editableStatus",""],[1,"btn-list","d-inline-flex"],["type","button","title","Salvar",1,"btn","btn-icon","btn-soft-success",3,"disabled","click"],["type","button","title","Excluir",1,"btn","btn-icon","btn-soft-danger",3,"click"],[1,"d-flex","align-items-center","gap-2"],[3,"ngClass"],["type","button","title","Desbloquear para edi\xe7\xe3o",1,"btn","btn-icon","btn-soft-muted",3,"click"],["formControlName","status",1,"form-select","form-select-sm",3,"disabled","change"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead",4)(5,"tr")(6,"th",5)(7,"input",6),t.bIt("change",function(){return n.toggleSelectAllVisible.emit()}),t.k0s()(),t.j41(8,"th",7),t.EFF(9,"Conta"),t.k0s(),t.j41(10,"th",7),t.EFF(11,"Categoria"),t.k0s(),t.j41(12,"th",8),t.EFF(13,"Valor"),t.k0s(),t.j41(14,"th",9),t.EFF(15,"Vencimento"),t.k0s(),t.j41(16,"th",10),t.EFF(17,"Status"),t.k0s(),t.j41(18,"th",11),t.EFF(19,"A\xe7\xf5es"),t.k0s()(),t.j41(20,"tr"),t.nrm(21,"th"),t.j41(22,"th")(23,"div",12)(24,"button",13),t.bIt("click",function(i){return n.toggleDropdown("conta",i)}),t.EFF(25),t.k0s(),t.j41(26,"div",14),t.bIt("click",function(i){return i.stopPropagation()}),t.DNE(27,F,4,4,"div",15),t.j41(28,"div",16)(29,"button",17),t.bIt("click",function(){return n.clearMulti("name")}),t.EFF(30," Limpar "),t.k0s(),t.j41(31,"button",18),t.bIt("click",function(){return n.ddContaOpen=!1}),t.EFF(32," OK "),t.k0s()()()()(),t.j41(33,"th")(34,"div",12)(35,"button",13),t.bIt("click",function(i){return n.toggleDropdown("categoria",i)}),t.EFF(36),t.k0s(),t.j41(37,"div",14),t.bIt("click",function(i){return i.stopPropagation()}),t.DNE(38,y,4,4,"div",15),t.j41(39,"div",16)(40,"button",17),t.bIt("click",function(){return n.clearMulti("categoryName")}),t.EFF(41," Limpar "),t.k0s(),t.j41(42,"button",18),t.bIt("click",function(){return n.ddCategoriaOpen=!1}),t.EFF(43," OK "),t.k0s()()()()(),t.j41(44,"th")(45,"input",19),t.bIt("input",function(i){return n.setColumnFilter("value",i.target.value)}),t.k0s()(),t.j41(46,"th")(47,"input",20),t.bIt("input",function(i){return n.setColumnFilter("date",i.target.value)}),t.k0s()(),t.j41(48,"th")(49,"div",12)(50,"button",13),t.bIt("click",function(i){return n.toggleDropdown("status",i)}),t.EFF(51),t.k0s(),t.j41(52,"div",14),t.bIt("click",function(i){return i.stopPropagation()}),t.DNE(53,w,4,4,"div",15),t.j41(54,"div",16)(55,"button",17),t.bIt("click",function(){return n.clearMulti("status")}),t.EFF(56," Limpar "),t.k0s(),t.j41(57,"button",18),t.bIt("click",function(){return n.ddStatusOpen=!1}),t.EFF(58," OK "),t.k0s()()()()(),t.nrm(59,"th"),t.k0s()(),t.j41(60,"tbody"),t.DNE(61,E,3,0,"tr",21),t.DNE(62,T,3,0,"tr",21),t.DNE(63,j,2,1,"ng-container",22),t.k0s()()(),t.j41(64,"div",23),t.EFF(65),t.k0s()()()),2&o&&(t.R7$(7),t.Y8G("checked",n.allVisibleSelected),t.R7$(16),t.AVh("show",n.ddContaOpen),t.R7$(2),t.SpI(" ",n.multiLabel("name","Conta")," "),t.R7$(1),t.AVh("show",n.ddContaOpen),t.R7$(1),t.Y8G("ngForOf",n.contaOptions),t.R7$(7),t.AVh("show",n.ddCategoriaOpen),t.R7$(2),t.SpI(" ",n.multiLabel("categoryName","Categoria")," "),t.R7$(1),t.AVh("show",n.ddCategoriaOpen),t.R7$(1),t.Y8G("ngForOf",n.categoriaOptions),t.R7$(7),t.Y8G("value",n.columnFilters.value),t.R7$(2),t.Y8G("value",n.columnFilters.date),t.R7$(2),t.AVh("show",n.ddStatusOpen),t.R7$(2),t.SpI(" ",n.multiLabel("status","Status")," "),t.R7$(1),t.AVh("show",n.ddStatusOpen),t.R7$(1),t.Y8G("ngForOf",n.statusOptions),t.R7$(8),t.Y8G("ngIf",n.loading),t.R7$(1),t.Y8G("ngIf",!n.loading&&0===n.rows.length),t.R7$(1),t.Y8G("ngForOf",n.rows)("ngForTrackBy",n.trackById),t.R7$(2),t.Lme(" ",n.rows.length," ",1===n.rows.length?"registro":"registros"," na tela "))},dependencies:[p.YU,p.Sq,p.bT,c.xH,c.y7,c.me,c.wz,c.BC,c.cb,c.j4,c.JD],encapsulation:2})}}return a})(),A=(()=>{class a{constructor(){this.month="",this.showToolbar=!1,this.monthChange=new t.bkB,this.toggleToolbar=new t.bkB,this.openAddBatch=new t.bkB,this.openCreate=new t.bkB,this.refresh=new t.bkB}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-conta-mensal-header"]],inputs:{month:"month",showToolbar:"showToolbar"},outputs:{monthChange:"monthChange",toggleToolbar:"toggleToolbar",openAddBatch:"openAddBatch",openCreate:"openCreate",refresh:"refresh"},decls:21,vars:3,consts:[[1,"row","g-2","align-items-center"],[1,"col-12","col-lg-4"],[1,"page-pretitle"],[1,"page-title"],[1,"col-12","col-lg-8","d-print-none"],[1,"d-flex","justify-content-end","gap-2","flex-wrap"],[1,"input-icon"],["type","month",1,"form-control",3,"value","change"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"collapse"],[1,"d-flex","justify-content-end","mt-2"],[1,"btn-list"],["type","button",1,"btn","btn-primary","btn-lg-icon",3,"click"],["type","button",1,"btn","btn-outline-secondary","btn-lg-icon",3,"click"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3,"Financeiro"),t.k0s(),t.j41(4,"h2",3),t.EFF(5,"Contas a Pagar"),t.k0s()(),t.j41(6,"div",4)(7,"div",5)(8,"div",6)(9,"input",7),t.bIt("change",function(i){return n.monthChange.emit(i.target.value)}),t.k0s()(),t.j41(10,"button",8),t.bIt("click",function(){return n.toggleToolbar.emit()}),t.EFF(11," \u2304 "),t.k0s()(),t.j41(12,"div",9)(13,"div",10)(14,"div",11)(15,"button",12),t.bIt("click",function(){return n.openAddBatch.emit()}),t.EFF(16,"\u2795 Adicionar em lote"),t.k0s(),t.j41(17,"button",12),t.bIt("click",function(){return n.openCreate.emit()}),t.EFF(18,"\u2795 Nova transa\xe7\xe3o"),t.k0s(),t.j41(19,"button",13),t.bIt("click",function(){return n.refresh.emit()}),t.EFF(20,"\u27f3 Atualizar"),t.k0s()()()()()()),2&o&&(t.R7$(9),t.Y8G("value",n.month),t.R7$(3),t.AVh("show",n.showToolbar))}})}}return a})();function G(a,r){if(1&a&&(t.j41(0,"option",10),t.EFF(1),t.k0s()),2&a){const e=r.$implicit;t.Y8G("value",e)("hidden",!e),t.R7$(1),t.JRh(e)}}let N=(()=>{class a{constructor(){this.statusOptions=[],this.status="",this.from="",this.to="",this.filtersChange=new t.bkB,this.clearAll=new t.bkB}emitChange(e){const o={status:this.status,from:this.from,to:this.to,...e};this.filtersChange.emit(o)}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-conta-mensal-filtros"]],inputs:{statusOptions:"statusOptions",status:"status",from:"from",to:"to"},outputs:{filtersChange:"filtersChange",clearAll:"clearAll"},decls:20,vars:4,consts:[[1,"card","p-3","mt-3"],[1,"row","g-2","align-items-end","mt-1"],[1,"col-12","col-lg-3"],[1,"form-label","small","mb-1"],[1,"form-select","form-select-sm",3,"value","change"],["value",""],[3,"value","hidden",4,"ngFor","ngForOf"],[1,"col-6","col-lg-3"],["type","date",1,"form-control","form-control-sm",3,"value","change"],["type","button",1,"btn","btn-outline-danger","btn-sm","w-100",3,"click"],[3,"value","hidden"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),t.EFF(4,"Status (geral)"),t.k0s(),t.j41(5,"select",4),t.bIt("change",function(i){return n.emitChange({status:i.target.value})}),t.j41(6,"option",5),t.EFF(7,"Todos"),t.k0s(),t.DNE(8,G,2,3,"option",6),t.k0s()(),t.j41(9,"div",7)(10,"label",3),t.EFF(11,"Vencimento de"),t.k0s(),t.j41(12,"input",8),t.bIt("change",function(i){return n.emitChange({from:i.target.value})}),t.k0s()(),t.j41(13,"div",7)(14,"label",3),t.EFF(15,"Vencimento at\xe9"),t.k0s(),t.j41(16,"input",8),t.bIt("change",function(i){return n.emitChange({to:i.target.value})}),t.k0s()(),t.j41(17,"div",2)(18,"button",9),t.bIt("click",function(){return n.clearAll.emit()}),t.EFF(19," Limpar filtros "),t.k0s()()()()),2&o&&(t.R7$(5),t.Y8G("value",n.status),t.R7$(3),t.Y8G("ngForOf",n.statusOptions),t.R7$(4),t.Y8G("value",n.from),t.R7$(4),t.Y8G("value",n.to))},dependencies:[p.Sq,c.xH,c.y7]})}}return a})(),O=(()=>{class a{constructor(){this.receita=0,this.despesa=0,this.saldo=0,this.count=0}money(e){return(0,d.XZ)(e)}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-conta-mensal-totais"]],inputs:{receita:"receita",despesa:"despesa",saldo:"saldo",count:"count"},decls:21,vars:9,consts:[[1,"card","mb-3"],[1,"card-body","d-flex","flex-wrap","gap-4","align-items-center"],[1,"text-muted","small"],[1,"fw-bold","fs-4","text-success"],[1,"vr"],[1,"fw-bold","fs-4","text-danger"],[1,"fw-bold","fs-4"],[1,"ms-auto","text-muted","small"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div")(3,"div",2),t.EFF(4,"Receita (Selecionados)"),t.k0s(),t.j41(5,"div",3),t.EFF(6),t.k0s()(),t.nrm(7,"div",4),t.j41(8,"div")(9,"div",2),t.EFF(10,"Despesa (Selecionados)"),t.k0s(),t.j41(11,"div",5),t.EFF(12),t.k0s()(),t.nrm(13,"div",4),t.j41(14,"div")(15,"div",2),t.EFF(16,"Saldo (Selecionados)"),t.k0s(),t.j41(17,"div",6),t.EFF(18),t.k0s()(),t.j41(19,"div",7),t.EFF(20),t.k0s()()()),2&o&&(t.R7$(6),t.JRh(n.money(n.receita)),t.R7$(6),t.JRh(n.money(n.despesa)),t.R7$(5),t.AVh("text-danger",n.saldo<0)("text-success",n.saldo>=0),t.R7$(1),t.SpI(" ",n.money(n.saldo)," "),t.R7$(2),t.Lme(" ",n.count," ",1===n.count?"item":"itens"," selecionado(s) "))}})}}return a})();var D=u(8359),V=u(3336);function L(a,r){if(1&a&&(t.j41(0,"div",25),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.AVh("alert-danger","error"===e.alert.type)("alert-success","success"===e.alert.type),t.R7$(1),t.SpI(" ",e.alert.message," ")}}function B(a,r){if(1&a){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"input",27),t.bIt("change",function(){const s=t.eBV(e).$implicit,i=t.XpG(2);return t.Njj(i.toggleOne(s.id))}),t.k0s()(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s()()}if(2&a){const e=r.$implicit,o=t.XpG(2);t.R7$(2),t.Y8G("disabled",o.disabledIds.has(e.id)||o.saving)("checked",o.selectedIds.has(e.id)),t.BMQ("aria-label","Selecionar conta "+e.name),t.R7$(1),t.AVh("text-muted",o.disabledIds.has(e.id)),t.R7$(1),t.JRh(e.name),t.R7$(1),t.AVh("text-muted",o.disabledIds.has(e.id)),t.R7$(1),t.SpI(" ",o.money(e.value)," ")}}function Y(a,r){if(1&a&&(t.qex(0),t.DNE(1,B,7,9,"tr",26),t.bVm()),2&a){const e=t.XpG();t.R7$(1),t.Y8G("ngForOf",e.contas)}}function X(a,r){1&a&&(t.j41(0,"tr")(1,"td",28),t.EFF(2," Nenhuma conta encontrada. "),t.k0s()())}const P=function(){return{display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem",overflowY:"auto"}},U=function(){return{width:"100%",maxWidth:"720px",margin:0}},H=function(){return{maxHeight:"80vh",overflow:"hidden"}};let J=(()=>{class a{constructor(e,o){this.contaService=e,this.contaMensalService=o,this.closed=new t.bkB,this.alert={type:"",message:""},this.saving=!1,this.contas=[],this.contasMensais=[],this.disabledIds=new Set,this.selectedIds=new Set,this.sub=new D.yU}ngOnInit(){this.load()}ngOnDestroy(){this.sub.unsubscribe(),this.alertTimer&&clearTimeout(this.alertTimer)}money(e){return(0,d.XZ)(e)}get selectableAccounts(){return this.contas.filter(e=>!this.disabledIds.has(e.id))}get allSelected(){const e=this.selectableAccounts;return e.length>0&&e.every(o=>this.selectedIds.has(o.id))}get selectedCount(){return this.selectedIds.size}close(e=!1){this.closed.emit(e)}showError(e){this.alert={type:"error",message:e},this.alertTimer&&clearTimeout(this.alertTimer),this.alertTimer=setTimeout(()=>this.alert={type:"",message:""},6e3)}showSuccess(e){this.alert={type:"success",message:e},this.alertTimer&&clearTimeout(this.alertTimer),this.alertTimer=setTimeout(()=>this.alert={type:"",message:""},4e3)}toggleOne(e){const o=new Set(this.selectedIds);o.has(e)?o.delete(e):o.add(e),this.selectedIds=o}toggleAll(){this.selectedIds=this.allSelected?new Set:new Set(this.selectableAccounts.map(e=>e.id))}load(){var e=this;return(0,m.A)(function*(){try{const[o,n]=yield Promise.all([e.contaService.list(),e.contaMensalService.GetTransactionByDate(String(e.month))]);e.contas=o??[],e.contasMensais=n??[];const s=new Set(e.contasMensais.flatMap(i=>i.idAccount));e.disabledIds=s,console.log(e.disabledIds),e.selectedIds=new Set([...e.selectedIds].filter(i=>!e.disabledIds.has(i)))}catch{e.showError("Erro ao carregar contas/transa\xe7\xf5es.")}})()}handleSave(){var e=this;return(0,m.A)(function*(){if(0===e.selectedIds.size)return void e.showError("Por favor, selecione ao menos uma conta!");e.saving=!0;const o=e.contas.filter(i=>e.selectedIds.has(i.id)).map(i=>({date:(0,d.EB)(e.month,i.dataOperacao),name:i.name,idAccount:i.id,value:(0,d.Tf)(i.value),status:"PENDENTE"}));let n=0,s=0;for(const i of o)try{(yield e.contaMensalService.createContaMensal(i))?n++:s++}catch{s++}e.saving=!1,n>0&&(e.showSuccess(`${n} ${1===n?"conta adicionada":"contas adicionadas"} com sucesso.`),e.close(!0)),s>0&&e.showError("Houve erros ao processar algumas contas.")})()}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(V.l),t.rXU(_.D))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-modal-adicionar-em-lote"]],inputs:{month:"month"},outputs:{closed:"closed"},decls:38,vars:16,consts:[[1,"modal-backdrop","show","my-backdrop",3,"click"],["tabindex","-1","role","dialog",1,"modal","show",3,"ngStyle"],[1,"position-fixed","top-0","start-50","translate-middle-x","mt-3",2,"z-index","1100","width","min(720px, 92vw)"],["class","alert",3,"alert-danger","alert-success",4,"ngIf"],["role","document",1,"modal-dialog",3,"ngStyle"],[1,"modal-content",3,"ngStyle"],[1,"modal-header"],[1,"modal-title","m-0"],["type","button","aria-label","Close",1,"btn","btn-close",3,"click"],[1,"modal-body",2,"overflow-y","auto"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"form-check"],["id","check-all","type","checkbox",1,"form-check-input",3,"checked","disabled","change"],["for","check-all",1,"form-check-label"],[1,"text-muted"],[1,"table-responsive"],[1,"table","table-hover","align-middle"],[1,"info","colorwhite"],[2,"width","48px"],[1,"text-nowrap"],[4,"ngIf","ngIfElse"],["emptyState",""],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"alert"],[4,"ngFor","ngForOf"],["type","checkbox",1,"form-check-input",3,"disabled","checked","change"],["colspan","3",1,"text-center","text-muted","py-4"]],template:function(o,n){if(1&o&&(t.j41(0,"div",0),t.bIt("click",function(){return n.close(!1)}),t.k0s(),t.j41(1,"div",1)(2,"div",2),t.DNE(3,L,2,5,"div",3),t.k0s(),t.j41(4,"div",4)(5,"div",5)(6,"div",6)(7,"h4",7),t.EFF(8,"Contas cadastradas"),t.k0s(),t.j41(9,"button",8),t.bIt("click",function(){return n.close(!1)}),t.k0s()(),t.j41(10,"div",9)(11,"div",10)(12,"div",11)(13,"input",12),t.bIt("change",function(){return n.toggleAll()}),t.k0s(),t.j41(14,"label",13),t.EFF(15),t.k0s()(),t.j41(16,"small",14),t.EFF(17," Selecionados: "),t.j41(18,"strong"),t.EFF(19),t.k0s()()(),t.j41(20,"div",15)(21,"table",16)(22,"thead")(23,"tr",17),t.nrm(24,"th",18),t.j41(25,"th"),t.EFF(26,"Nome"),t.k0s(),t.j41(27,"th",19),t.EFF(28,"Valor"),t.k0s()()(),t.j41(29,"tbody"),t.DNE(30,Y,2,1,"ng-container",20),t.DNE(31,X,3,0,"ng-template",null,21,t.C5r),t.k0s()()()(),t.j41(33,"div",22)(34,"button",23),t.bIt("click",function(){return n.close(!1)}),t.EFF(35," Fechar "),t.k0s(),t.j41(36,"button",24),t.bIt("click",function(){return n.handleSave()}),t.EFF(37),t.k0s()()()()()),2&o){const s=t.sdS(32);let i;t.R7$(1),t.Y8G("ngStyle",t.lJ4(13,P)),t.R7$(2),t.Y8G("ngIf",n.alert.message),t.R7$(1),t.Y8G("ngStyle",t.lJ4(14,U)),t.R7$(1),t.Y8G("ngStyle",t.lJ4(15,H)),t.R7$(8),t.Y8G("checked",n.allSelected&&n.selectableAccounts.length>0)("disabled",0===n.selectableAccounts.length||n.saving),t.R7$(2),t.SpI(" Selecionar todos (",n.selectableAccounts.length,") "),t.R7$(4),t.JRh(n.selectedCount),t.R7$(11),t.Y8G("ngIf",(null!==(i=null==n.contas?null:n.contas.length)&&void 0!==i?i:0)>0)("ngIfElse",s),t.R7$(4),t.Y8G("disabled",n.saving),t.R7$(2),t.Y8G("disabled",n.saving||0===n.selectedIds.size),t.R7$(1),t.SpI(" ",n.saving?"Adicionando...":"ADICIONAR ITENS"," ")}},dependencies:[p.Sq,p.bT,p.B3],styles:['@charset "UTF-8";.my-backdrop[_ngcontent-%COMP%]{background:rgba(0,0,0,.55)}.modal.show[_ngcontent-%COMP%]{z-index:1055}.modal-backdrop.show[_ngcontent-%COMP%]{z-index:1050}']})}}return a})();function z(a,r){1&a&&(t.j41(0,"div",19),t.EFF(1," Informe um nome v\xe1lido. "),t.k0s())}function q(a,r){1&a&&(t.j41(0,"div",19),t.EFF(1," Informe um valor. "),t.k0s())}function x(a,r){if(1&a&&(t.j41(0,"option",14),t.EFF(1),t.k0s()),2&a){const e=r.$implicit;t.Y8G("ngValue",e.id),t.R7$(1),t.JRh(e.name)}}function Z(a,r){1&a&&(t.j41(0,"div",19),t.EFF(1," Selecione uma categoria. "),t.k0s())}let K=(()=>{class a{constructor(e,o,n){this.fb=e,this.contaMensalService=o,this.categoryService=n,this.closed=new t.bkB,this.dataOperacao=null,this.saving=!1,this.categorias=[],this.form=this.fb.group({nomeConta:["",[c.k0.required,c.k0.minLength(2)]],valor:[null,[c.k0.required]],dataOperacao:[null,[c.k0.required]],categoryid:[null,[c.k0.required,c.k0.min(1),c.k0.max(31)]]})}ngOnInit(){var e=this;return(0,m.A)(function*(){e.categorias=yield e.categoryService.list()})()}close(e=!1){this.closed.emit(e)}save(){var e=this;return(0,m.A)(function*(){if(e.form.invalid)e.form.markAllAsTouched();else try{e.saving=!0;const o={date:(0,d.EB)(e.dataOperacao,e.form.value.dataOperacao),name:e.form.value.nomeConta,categoryid:Number(e.form.value.categoryid),value:100*Number(e.form.value.valor)||0,status:"PENDENTE"};yield e.contaMensalService.createContaMensal(o),e.close(!0)}catch{alert("Erro ao salvar conta.")}finally{e.saving=!1}})()}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(c.ok),t.rXU(_.D),t.rXU(C.M))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-modal-nova-conta-mensal"]],inputs:{dataOperacao:"dataOperacao"},outputs:{closed:"closed"},decls:35,vars:14,consts:[[1,"modal-backdrop-custom",3,"click"],["role","dialog","aria-modal","true",1,"modal-custom"],[1,"modal-card","card"],[1,"card-header"],[1,"card-title","m-0"],["type","button","aria-label","Fechar",1,"btn-close",3,"click"],[1,"card-body",3,"formGroup"],[1,"mb-3"],[1,"form-label"],["formControlName","nomeConta",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["type","number","formControlName","valor",1,"form-control"],["formControlName","dataOperacao","maxlength","2","placeholder","Ex: 10",1,"form-control"],["formControlName","categoryid",1,"form-select"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"card-footer","d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"invalid-feedback"]],template:function(o,n){1&o&&(t.j41(0,"div",0),t.bIt("click",function(){return n.close(!1)}),t.k0s(),t.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),t.EFF(5,"Adicionar nova conta"),t.k0s(),t.j41(6,"button",5),t.bIt("click",function(){return n.close(!1)}),t.k0s()(),t.j41(7,"div",6)(8,"div",7)(9,"label",8),t.EFF(10,"Nome conta"),t.k0s(),t.nrm(11,"input",9),t.DNE(12,z,2,0,"div",10),t.k0s(),t.j41(13,"div",7)(14,"label",8),t.EFF(15,"Valor"),t.k0s(),t.nrm(16,"input",11),t.DNE(17,q,2,0,"div",10),t.k0s(),t.j41(18,"div",7)(19,"label",8),t.EFF(20,"Dia Vencimento"),t.k0s(),t.nrm(21,"input",12),t.k0s(),t.j41(22,"div",7)(23,"label",8),t.EFF(24,"Categoria"),t.k0s(),t.j41(25,"select",13)(26,"option",14),t.EFF(27,"Selecione..."),t.k0s(),t.DNE(28,x,2,2,"option",15),t.k0s(),t.DNE(29,Z,2,0,"div",10),t.k0s()(),t.j41(30,"div",16)(31,"button",17),t.bIt("click",function(){return n.close(!1)}),t.EFF(32,"Cancelar"),t.k0s(),t.j41(33,"button",18),t.bIt("click",function(){return n.save()}),t.EFF(34),t.k0s()()()()),2&o&&(t.R7$(7),t.Y8G("formGroup",n.form),t.R7$(4),t.AVh("is-invalid",n.form.controls.nomeConta.touched&&n.form.controls.nomeConta.invalid),t.R7$(1),t.Y8G("ngIf",n.form.controls.nomeConta.touched&&n.form.controls.nomeConta.invalid),t.R7$(4),t.AVh("is-invalid",n.form.controls.valor.touched&&n.form.controls.valor.invalid),t.R7$(1),t.Y8G("ngIf",n.form.controls.valor.touched&&n.form.controls.valor.invalid),t.R7$(8),t.AVh("is-invalid",n.form.controls.categoryid.touched&&n.form.controls.categoryid.invalid),t.R7$(1),t.Y8G("ngValue",null),t.R7$(2),t.Y8G("ngForOf",n.categorias),t.R7$(1),t.Y8G("ngIf",n.form.controls.categoryid.touched&&n.form.controls.categoryid.invalid),t.R7$(4),t.Y8G("disabled",n.saving),t.R7$(1),t.SpI(" ",n.saving?"Salvando...":"Salvar"," "))},dependencies:[p.Sq,p.bT,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.cb,c.tU,c.j4,c.JD],styles:[".modal-backdrop-custom[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:3000}.modal-custom[_ngcontent-%COMP%]{position:fixed;inset:0;display:grid;place-items:center;z-index:3001;padding:16px}.modal-card[_ngcontent-%COMP%]{width:100%;max-width:620px}"]})}}return a})();function W(a,r){if(1&a&&(t.j41(0,"div",10)(1,"div",11),t.EFF(2),t.k0s()()),2&a){const e=t.XpG();t.R7$(1),t.AVh("alert-success","success"===e.alert.type)("alert-danger","error"===e.alert.type),t.R7$(1),t.SpI(" ",e.alert.message," ")}}function Q(a,r){if(1&a){const e=t.RV6();t.j41(0,"app-modal-adicionar-em-lote",12),t.bIt("closed",function(n){t.eBV(e);const s=t.XpG();return s.showModalAdd=!1,t.Njj(n&&s.onRefresh())}),t.k0s()}if(2&a){const e=t.XpG();t.Y8G("month",e.selectedMonth)}}function tt(a,r){if(1&a){const e=t.RV6();t.j41(0,"app-modal-nova-conta-mensal",13),t.bIt("closed",function(n){t.eBV(e);const s=t.XpG();return s.showModalCreate=!1,t.Njj(n&&s.onRefresh())}),t.k0s()}if(2&a){const e=t.XpG();t.Y8G("dataOperacao",e.selectedMonth)}}const et=[{path:"",component:(()=>{class a{constructor(e,o){this.service=e,this.categoryService=o,this.STATUS=["PENDENTE","PAGO NO PRAZO","AGUARDANDO","PAGO ATRASADO"],this.rows=[],this.loading=!1,this.alert={type:"",message:""},this.showToolbar=!1,this.showModalCreate=!1,this.showModalAdd=!1,this.defaultMonth=this.getCurrentYearMonth(),this.selectedMonth=this.defaultMonth,this.filterStatus="",this.filterDateFrom="",this.filterDateTo="",this.columnFilters={name:[],categoryName:[],subCategory:"",value:"",date:"",status:[]},this.categorias=[],this.selectedIds=new Set}ngOnInit(){var e=this;return(0,m.A)(function*(){e.categorias=yield e.categoryService.list(),yield e.loadMonth(e.defaultMonth)})()}loadMonth(e){var o=this;return(0,m.A)(function*(){try{o.loading=!0,o.selectedMonth=e;const n=yield o.service.getGroupingByMonth((0,d.ng)(e));o.rows=yield o.flatten(n??[]),o.selectedIds=new Set}catch{o.alert={type:"error",message:"Erro ao carregar transa\xe7\xf5es."},setTimeout(()=>o.alert={type:"",message:""},5e3)}finally{o.loading=!1}})()}flatten(e){var o=this;return(0,m.A)(function*(){const n=[];for(const s of e??[])n.push({id:s.id,idAccount:s.idAccount??0,name:s.name,value:s.value,date:new Date(s.date),categoryId:s.categoryId??s.account.categoryId,categoryName:yield o.buscarCategoria(s.categoryId??s.account.categoryId),subCategory:yield o.buscarSubCategoria(s.categoryId??s.account.categoryId),status:s.status,statusSalvo:s.status,desbloqueiaCampos:!1});return n})()}buscarCategoria(e){var o=this;return(0,m.A)(function*(){var n=o.categorias.find(s=>s.id===e);return n?n.name:""})()}buscarSubCategoria(e){var o=this;return(0,m.A)(function*(){var n=o.categorias.find(s=>s.id===e);return n?n.subCategory:""})()}get lockedById(){const e=new Map;return this.rows.forEach(o=>e.set(o.id,"PENDENTE"!==o.statusSalvo&&!o.desbloqueiaCampos)),e}get filteredRows(){const o=(n,s)=>{if(!s||0===s.length)return!0;const i=String(n??"").toLowerCase();return s.some(l=>String(l).toLowerCase()===i)};return(this.rows??[]).filter(n=>{if(this.filterStatus&&n.statusSalvo!==this.filterStatus)return!1;const s=(0,d.E4)(n.date),i=s?new Date(s):null;if(i&&!Number.isNaN(i.getTime())){if(i.setHours(0,0,0,0),this.filterDateFrom){const l=new Date(this.filterDateFrom);if(l.setHours(0,0,0,0),i<l)return!1}if(this.filterDateTo){const l=new Date(this.filterDateTo);if(l.setHours(0,0,0,0),i>l)return!1}}if(!o(n.name,this.columnFilters.name)||!o(n.categoryName,this.columnFilters.categoryName)||!o(n.status,this.columnFilters.status)||this.columnFilters.date&&!String(n.date??"").includes(this.columnFilters.date))return!1;if(this.columnFilters.value){const l=String(this.columnFilters.value).trim(),h=Number(l.replace(",","."));if(Number.isFinite(h)&&""!==l){if((0,d.Tf)(n.value)<h)return!1}else if(!((n,s)=>!s||String(n??"").toLowerCase().includes(String(s).toLowerCase()))(n.value,l))return!1}return!0})}get sortedRows(){const e=o=>{const n=String(o||"").toLowerCase();return"receita"===n||"receitas"===n?0:"despesa"===n||"despesas"===n?1:2};return[...this.filteredRows].sort((o,n)=>{const s=e(o.subCategory),i=e(n.subCategory);return s!==i?s-i:String(o.name||"").toUpperCase().localeCompare(String(n.name||"").toUpperCase(),"pt-BR")})}get allVisibleSelected(){return!!this.sortedRows.length&&this.sortedRows.every(e=>this.selectedIds.has(e.id))}get selectedTotals(){let e=0,o=0;const n=this.sortedRows.filter(s=>this.selectedIds.has(s.id));return n.forEach(s=>{const i=(0,d.Tf)(s.value),l=String(s.subCategory||"").toLowerCase();("receita"===l||"receitas"===l)&&(e+=i),("despesa"===l||"despesas"===l)&&(o+=i)}),{receita:e,despesa:o,saldo:e-o,count:n.length}}onMonthChange(e){e&&this.loadMonth(e)}onToggleToolbar(){this.showToolbar=!this.showToolbar}onOpenAddBatch(){if(!this.selectedMonth)return this.showErrorRequired();this.showModalAdd=!0}onOpenCreate(){if(!this.selectedMonth)return this.showErrorRequired();this.showModalCreate=!0}onRefresh(){if(!this.selectedMonth)return this.showErrorRequired();this.loadMonth(this.selectedMonth)}showErrorRequired(){this.alert={type:"error",message:"Preencha os campos obrigat\xf3rios"},setTimeout(()=>this.alert={type:"",message:""},5e3)}onGeneralFiltersChange(e){this.filterStatus=e.status,this.filterDateFrom=e.from,this.filterDateTo=e.to}onClearAllFilters(){this.filterStatus="",this.filterDateFrom="",this.filterDateTo="",this.columnFilters={name:[],categoryName:[],subCategory:"",value:"",date:"",status:[]}}onToggleSelectAllVisible(){const e=new Set(this.selectedIds);this.sortedRows.forEach(this.allVisibleSelected?o=>e.delete(o.id):o=>e.add(o.id)),this.selectedIds=e}onToggleRow(e){const o=new Set(this.selectedIds);o.has(e)?o.delete(e):o.add(e),this.selectedIds=o}onColumnFiltersChange(e){this.columnFilters={...this.columnFilters,...e}}onChangeRowField(e){this.rows=this.rows.map(o=>o.id!==e.id?o:"value"===e.field?{...o,value:(0,d.XZ)(e.value)}:"date"===e.field?{...o,month:e.value}:{...o,status:e.value})}unlock(e){this.rows=this.rows.map(o=>o.id===e?{...o,desbloqueiaCampos:!0,status:o.statusSalvo}:o)}onSaveRow(e){var o=this;return(0,m.A)(function*(){const n=o.rows.find(s=>s.id===e);if(n){if(!(n.name&&n.value&&n.date&&n.status))return o.alert={type:"error",message:"Preencha os campos obrigat\xf3rios"},void setTimeout(()=>o.alert={type:"",message:""},5e3);try{const s={...n,value:(0,d.Tf)(n.value)},l=(yield o.service.updateTransaction(s))?.status??n.status;o.rows=o.rows.map(h=>h.id===e?{...h,status:l,statusSalvo:l,desbloqueiaCampos:"PENDENTE"===l&&h.desbloqueiaCampos}:h),o.alert={type:"success",message:"Transa\xe7\xe3o atualizada com sucesso!"},setTimeout(()=>o.alert={type:"",message:""},5e3)}catch{o.alert={type:"error",message:"Erro ao atualizar. Tente novamente."},setTimeout(()=>o.alert={type:"",message:""},5e3)}}})()}onDeleteRow(e){var o=this;return(0,m.A)(function*(){if(window.confirm("Tem certeza que deseja excluir esta transa\xe7\xe3o?"))try{yield o.service.deleteTransaction(e),o.rows=o.rows.filter(i=>i.id!==e);const s=new Set(o.selectedIds);s.delete(e),o.selectedIds=s,o.alert={type:"success",message:"Transa\xe7\xe3o deletada com sucesso!"},setTimeout(()=>o.alert={type:"",message:""},8e3)}catch{o.alert={type:"error",message:"Falha ao deletar. Tente novamente."},setTimeout(()=>o.alert={type:"",message:""},8e3)}})()}money(e){return(0,d.XZ)(e)}dateInput(e){return(0,d.E4)(e)}getCurrentYearMonth(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(_.D),t.rXU(C.M))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-conta-mensal-estrutura"]],decls:10,vars:20,consts:[[1,"page-body"],["class","container-xl pt-3",4,"ngIf"],[1,"container-xl"],[3,"month","showToolbar","monthChange","toggleToolbar","openAddBatch","openCreate","refresh"],[3,"statusOptions","status","from","to","filtersChange","clearAll"],[1,"container-xl","mt-3"],[3,"receita","despesa","saldo","count"],[3,"rows","loading","lockedById","selectedIds","allVisibleSelected","columnFilters","statusOptions","toggleSelectAllVisible","toggleRow","columnFiltersChange","changeField","unlock","saveRow","deleteRow"],[3,"month","closed",4,"ngIf"],[3,"dataOperacao","closed",4,"ngIf"],[1,"container-xl","pt-3"],[1,"alert"],[3,"month","closed"],[3,"dataOperacao","closed"]],template:function(o,n){1&o&&(t.j41(0,"div",0),t.DNE(1,W,3,5,"div",1),t.j41(2,"div",2)(3,"app-conta-mensal-header",3),t.bIt("monthChange",function(i){return n.onMonthChange(i)})("toggleToolbar",function(){return n.onToggleToolbar()})("openAddBatch",function(){return n.onOpenAddBatch()})("openCreate",function(){return n.onOpenCreate()})("refresh",function(){return n.onRefresh()}),t.k0s(),t.j41(4,"app-conta-mensal-filtros",4),t.bIt("filtersChange",function(i){return n.onGeneralFiltersChange(i)})("clearAll",function(){return n.onClearAllFilters()}),t.k0s()(),t.j41(5,"div",5),t.nrm(6,"app-conta-mensal-totais",6),t.j41(7,"app-conta-mensal-list",7),t.bIt("toggleSelectAllVisible",function(){return n.onToggleSelectAllVisible()})("toggleRow",function(i){return n.onToggleRow(i)})("columnFiltersChange",function(i){return n.onColumnFiltersChange(i)})("changeField",function(i){return n.onChangeRowField(i)})("unlock",function(i){return n.unlock(i)})("saveRow",function(i){return n.onSaveRow(i)})("deleteRow",function(i){return n.onDeleteRow(i)}),t.k0s(),t.DNE(8,Q,1,1,"app-modal-adicionar-em-lote",8),t.DNE(9,tt,1,1,"app-modal-nova-conta-mensal",9),t.k0s()()),2&o&&(t.R7$(1),t.Y8G("ngIf",n.alert.message),t.R7$(2),t.Y8G("month",n.selectedMonth)("showToolbar",n.showToolbar),t.R7$(1),t.Y8G("statusOptions",n.STATUS)("status",n.filterStatus)("from",n.filterDateFrom)("to",n.filterDateTo),t.R7$(2),t.Y8G("receita",n.selectedTotals.receita)("despesa",n.selectedTotals.despesa)("saldo",n.selectedTotals.saldo)("count",n.selectedTotals.count),t.R7$(1),t.Y8G("rows",n.sortedRows)("loading",n.loading)("lockedById",n.lockedById)("selectedIds",n.selectedIds)("allVisibleSelected",n.allVisibleSelected)("columnFilters",n.columnFilters)("statusOptions",n.STATUS),t.R7$(1),t.Y8G("ngIf",n.showModalAdd),t.R7$(1),t.Y8G("ngIf",n.showModalCreate))},dependencies:[p.bT,$,A,N,O,J,K],encapsulation:2})}}return a})()}];let nt=(()=>{class a{static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[b.iI.forChild(et),b.iI]})}}return a})();var ot=u(3887);let st=(()=>{class a{static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[ot.G,nt]})}}return a})()}}]);