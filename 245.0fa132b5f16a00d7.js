"use strict";(self.webpackChunkmy_finance_front=self.webpackChunkmy_finance_front||[]).push([[245],{9245:(D,u,l)=>{l.r(u),l.d(u,{CadastroContaMensalModule:()=>L});var r=l(4341),p=l(9032),d=l(467),t=l(540),f=l(3336),h=l(7008),m=l(177),F=l(9484);function g(o,s){1&o&&(t.j41(0,"div",19),t.EFF(1," Informe um nome v\xe1lido. "),t.k0s())}function v(o,s){1&o&&(t.j41(0,"div",19),t.EFF(1," Informe um valor. "),t.k0s())}function C(o,s){if(1&o&&(t.j41(0,"option",14),t.EFF(1),t.k0s()),2&o){const e=s.$implicit;t.Y8G("ngValue",e.id),t.R7$(1),t.JRh(e.name)}}function k(o,s){1&o&&(t.j41(0,"div",19),t.EFF(1," Selecione uma categoria. "),t.k0s())}let b=(()=>{class o{constructor(e,a){this.fb=e,this.contaService=a,this.account=null,this.categories=[],this.closed=new t.bkB,this.saving=!1,this.form=this.fb.group({name:["",[r.k0.required,r.k0.minLength(2)]],value:[null,[r.k0.required]],dataOperacao:[null,[r.k0.required]],categoryid:[null,[r.k0.required,r.k0.min(1),r.k0.max(31)]]})}ngOnInit(){this.account&&this.form.patchValue({name:this.account.name,value:this.account.value,dataOperacao:this.account.dataOperacao,categoryid:this.account.categoryid})}close(e=!1){this.closed.emit(e)}save(){var e=this;return(0,d.A)(function*(){if(e.form.invalid)e.form.markAllAsTouched();else try{e.saving=!0;const a={id:e.account?.id,name:e.form.value.name,value:100*Number(e.form.value.value)||0,categoryid:Number(e.form.value.categoryid),dataOperacao:Number(e.form.value.dataOperacao)};e.account?yield e.contaService.update(a):yield e.contaService.create(a),e.close(!0)}catch{alert("Erro ao salvar conta.")}finally{e.saving=!1}})()}static{this.\u0275fac=function(a){return new(a||o)(t.rXU(r.ok),t.rXU(f.l))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-conta-mensal-form"]],inputs:{account:"account",categories:"categories"},outputs:{closed:"closed"},decls:35,vars:15,consts:[[1,"modal-backdrop-custom",3,"click"],["role","dialog","aria-modal","true",1,"modal-custom"],[1,"modal-card","card"],[1,"card-header"],[1,"card-title","m-0"],["type","button","aria-label","Fechar",1,"btn-close",3,"click"],[1,"card-body",3,"formGroup"],[1,"mb-3"],[1,"form-label"],["formControlName","name",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["type","text","formControlName","value","currencyInput","",1,"form-control"],["formControlName","dataOperacao","maxlength","2","placeholder","Ex: 10",1,"form-control"],["formControlName","categoryid",1,"form-select"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"card-footer","d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"invalid-feedback"]],template:function(a,n){1&a&&(t.j41(0,"div",0),t.bIt("click",function(){return n.close(!1)}),t.k0s(),t.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),t.EFF(5),t.k0s(),t.j41(6,"button",5),t.bIt("click",function(){return n.close(!1)}),t.k0s()(),t.j41(7,"div",6)(8,"div",7)(9,"label",8),t.EFF(10,"Nome"),t.k0s(),t.nrm(11,"input",9),t.DNE(12,g,2,0,"div",10),t.k0s(),t.j41(13,"div",7)(14,"label",8),t.EFF(15,"Valor"),t.k0s(),t.nrm(16,"input",11),t.DNE(17,v,2,0,"div",10),t.k0s(),t.j41(18,"div",7)(19,"label",8),t.EFF(20,"Dia Vencimento"),t.k0s(),t.nrm(21,"input",12),t.k0s(),t.j41(22,"div",7)(23,"label",8),t.EFF(24,"Categoria"),t.k0s(),t.j41(25,"select",13)(26,"option",14),t.EFF(27,"Selecione..."),t.k0s(),t.DNE(28,C,2,2,"option",15),t.k0s(),t.DNE(29,k,2,0,"div",10),t.k0s()(),t.j41(30,"div",16)(31,"button",17),t.bIt("click",function(){return n.close(!1)}),t.EFF(32,"Cancelar"),t.k0s(),t.j41(33,"button",18),t.bIt("click",function(){return n.save()}),t.EFF(34),t.k0s()()()()),2&a&&(t.R7$(5),t.JRh(n.account?"Editar Conta":"Nova Conta"),t.R7$(2),t.Y8G("formGroup",n.form),t.R7$(4),t.AVh("is-invalid",n.form.controls.name.touched&&n.form.controls.name.invalid),t.R7$(1),t.Y8G("ngIf",n.form.controls.name.touched&&n.form.controls.name.invalid),t.R7$(4),t.AVh("is-invalid",n.form.controls.value.touched&&n.form.controls.value.invalid),t.R7$(1),t.Y8G("ngIf",n.form.controls.value.touched&&n.form.controls.value.invalid),t.R7$(8),t.AVh("is-invalid",n.form.controls.categoryid.touched&&n.form.controls.categoryid.invalid),t.R7$(1),t.Y8G("ngValue",null),t.R7$(2),t.Y8G("ngForOf",n.categories),t.R7$(1),t.Y8G("ngIf",n.form.controls.categoryid.touched&&n.form.controls.categoryid.invalid),t.R7$(4),t.Y8G("disabled",n.saving),t.R7$(1),t.SpI(" ",n.saving?"Salvando...":"Salvar"," "))},dependencies:[m.Sq,m.bT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.tU,r.j4,r.JD,F.r],styles:[".modal-backdrop-custom[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:3000}.modal-custom[_ngcontent-%COMP%]{position:fixed;inset:0;display:grid;place-items:center;z-index:3001;padding:16px}.modal-card[_ngcontent-%COMP%]{width:100%;max-width:620px}"]})}}return o})();function y(o,s){if(1&o&&(t.j41(0,"div",35),t.EFF(1),t.k0s()),2&o){const e=t.XpG();t.AVh("alert-success","success"===e.alert.type)("alert-danger","error"===e.alert.type),t.R7$(1),t.SpI(" ",e.alert.message," ")}}function _(o,s){if(1&o&&(t.j41(0,"option",36),t.EFF(1),t.k0s()),2&o){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(1),t.JRh(e.name)}}function E(o,s){if(1&o){const e=t.RV6();t.j41(0,"tr")(1,"td",37),t.EFF(2),t.k0s(),t.j41(3,"td",38),t.EFF(4),t.k0s(),t.j41(5,"td",39),t.EFF(6),t.k0s(),t.j41(7,"td",39),t.EFF(8),t.k0s(),t.j41(9,"td",39),t.EFF(10),t.k0s(),t.j41(11,"td",39)(12,"div",40)(13,"button",41),t.bIt("click",function(){const i=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.openEdit(i))}),t.EFF(14," \u270f\ufe0f "),t.k0s(),t.j41(15,"button",42),t.bIt("click",function(){const i=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.onDelete(i))}),t.EFF(16," \u{1f5d1}\ufe0f "),t.k0s()()()()}if(2&o){const e=s.$implicit,a=t.XpG();t.R7$(2),t.JRh(e.id),t.R7$(2),t.JRh(e.name),t.R7$(2),t.JRh(a.formatCurrency(e.value)),t.R7$(2),t.JRh(e.dataOperacao),t.R7$(2),t.JRh(a.categoryNameOf(e.categoryid))}}function j(o,s){if(1&o){const e=t.RV6();t.j41(0,"tr")(1,"td",43)(2,"div",44)(3,"div",45),t.EFF(4,"\u{1f9fe}"),t.k0s(),t.j41(5,"div",46),t.EFF(6,"Nenhuma conta encontrada"),t.k0s(),t.j41(7,"div",47),t.EFF(8,"Tente ajustar os filtros ou cadastre uma nova conta."),t.k0s(),t.j41(9,"button",48),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.openCreate())}),t.EFF(10,"+ Nova conta"),t.k0s()()()()}}function M(o,s){1&o&&(t.j41(0,"tr")(1,"td",49),t.EFF(2,"Carregando..."),t.k0s()())}function R(o,s){if(1&o&&(t.j41(0,"tr")(1,"td",50),t.EFF(2),t.k0s()()),2&o){const e=t.XpG();t.R7$(2),t.JRh(e.errorMsg)}}function $(o,s){if(1&o&&(t.j41(0,"tfoot")(1,"tr")(2,"td",51),t.EFF(3,"Total:"),t.k0s(),t.j41(4,"td",52),t.EFF(5),t.k0s(),t.nrm(6,"td",53),t.k0s()()),2&o){const e=t.XpG();t.R7$(5),t.JRh(e.formatCurrency(e.total))}}function I(o,s){if(1&o){const e=t.RV6();t.j41(0,"app-conta-mensal-form",54),t.bIt("closed",function(n){t.eBV(e);const i=t.XpG();return t.Njj(i.closeForm(n))}),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("account",e.editing)("categories",e.categories)}}const N=[{path:"",component:(()=>{class o{constructor(e,a){this.contaService=e,this.categoryService=a,this.accounts=[],this.categories=[],this.filtered=[],this.loading=!1,this.errorMsg="",this.q="",this.catFilter="ALL",this.total=0,this.showModalForm=!1,this.editing=null,this.alert={type:"",message:""}}ngOnInit(){var e=this;return(0,d.A)(function*(){yield e.load()})()}load(){var e=this;return(0,d.A)(function*(){try{e.loading=!0,e.errorMsg="";const[a,n]=yield Promise.all([e.contaService.list(),e.categoryService.list()]);e.accounts=a??[],e.categories=n??[],e.applyFilters()}catch(a){e.errorMsg=a?.message??"Erro ao carregar contas."}finally{e.loading=!1}})()}categoryNameOf(e){return this.categories.find(a=>a.id===e)?.name??"\u2014"}applyFilters(){const e=this.q.trim().toLowerCase(),a="ALL"===this.catFilter?null:Number(this.catFilter);this.filtered=[...this.accounts].filter(n=>!a||n.categoryid===a).filter(n=>{if(!e)return!0;const i=this.categoryNameOf(n.categoryid).toLowerCase();return(n.name??"").toLowerCase().includes(e)||String(n.id).includes(e)||i.includes(e)}).sort((n,i)=>(n.name??"").localeCompare(i.name??"")),this.total=this.filtered.reduce((n,i)=>n+(Number(i.value)||0),0)}onSearchChange(e){this.q=e,this.applyFilters()}onCatChange(e){this.catFilter=e,this.applyFilters()}openCreate(){this.editing=null,this.showModalForm=!0}openEdit(e){this.editing=e,this.showModalForm=!0}closeForm(e){this.showModalForm=!1,this.editing=null,e&&this.load()}formatCurrency(e){const n=(Number(e)||0)/100;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)}onDelete(e){var a=this;return(0,d.A)(function*(){if(window.confirm("Tem certeza que deseja excluir esta conta?"))try{yield a.contaService.delete(e.id),a.alert={type:"success",message:"Conta deletada com sucesso!"},setTimeout(()=>a.alert={type:"",message:""},3e3),yield a.load()}catch{a.alert={type:"error",message:"Falha ao deletar conta. Tente novamente."},setTimeout(()=>a.alert={type:"",message:""},15e3)}})()}static{this.\u0275fac=function(a){return new(a||o)(t.rXU(f.l),t.rXU(h.M))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-conta-mensal-list"]],decls:56,vars:12,consts:[[1,"container-xl","py-3"],["class","alert",3,"alert-success","alert-danger",4,"ngIf"],[1,"page-header","d-print-none","mb-3"],[1,"row","align-items-center"],[1,"col"],[1,"page-pretitle"],[1,"page-title"],[1,"col-auto","ms-auto","d-print-none"],[1,"btn-list"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"card","mb-3"],[1,"card-body"],[1,"row","g-2","align-items-end"],[1,"col-12","col-md-5"],[1,"form-label"],["placeholder","Nome, ID ou Categoria",1,"form-control",3,"value","input"],[1,"col-12","col-md-4"],[1,"form-select",3,"value","change"],["value","ALL"],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-md-3","d-flex","justify-content-md-end"],[1,"text-muted","small","mt-3","mt-md-0"],[1,"card"],[1,"table-responsive","table-responsive-sticky"],[1,"table","card-table","table-vcenter","table-hover","align-middle","table-sticky"],[1,"bg-body-tertiary"],[1,"w-1"],[1,"w-6","text-center"],[1,"w-4","text-center","text-nowrap"],[1,"w-2","text-center","text-nowrap"],[1,"w-2","text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"account","categories","closed",4,"ngIf"],[1,"alert"],[3,"value"],[1,"text-muted","text-center"],[1,"fw-medium","text-center"],[1,"text-center"],[1,"d-flex","justify-content-center"],["type","button","title","Editar",1,"btn","btn-icon","btn-soft-secondary",3,"click"],["type","button","title","Excluir",1,"btn","btn-icon","btn-soft-danger",3,"click"],["colspan","6",1,"p-5"],[1,"text-center","text-secondary"],[1,"fs-1","mb-2"],[1,"mb-1"],[1,"text-muted","mb-3"],[1,"btn","btn-primary",3,"click"],["colspan","6",1,"text-center","text-secondary","py-4"],["colspan","6",1,"text-center","text-danger","py-4"],["colspan","2",1,"text-end","fw-bold"],[1,"text-end","fw-bold"],["colspan","3"],[3,"account","categories","closed"]],template:function(a,n){1&a&&(t.j41(0,"div",0),t.DNE(1,y,2,5,"div",1),t.j41(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.EFF(6,"Cadastros"),t.k0s(),t.j41(7,"h2",6),t.EFF(8,"Contas"),t.k0s()(),t.j41(9,"div",7)(10,"div",8)(11,"button",9),t.bIt("click",function(){return n.load()}),t.EFF(12," Atualizar "),t.k0s(),t.j41(13,"button",10),t.bIt("click",function(){return n.openCreate()}),t.EFF(14," + Nova conta "),t.k0s()()()()(),t.j41(15,"div",11)(16,"div",12)(17,"div",13)(18,"div",14)(19,"label",15),t.EFF(20,"Buscar"),t.k0s(),t.j41(21,"input",16),t.bIt("input",function(c){return n.onSearchChange(c.target.value)}),t.k0s()(),t.j41(22,"div",17)(23,"label",15),t.EFF(24,"Categoria"),t.k0s(),t.j41(25,"select",18),t.bIt("change",function(c){return n.onCatChange(c.target.value)}),t.j41(26,"option",19),t.EFF(27,"Todas"),t.k0s(),t.DNE(28,_,2,2,"option",20),t.k0s()(),t.j41(29,"div",21)(30,"div",22),t.EFF(31),t.k0s()()()()(),t.j41(32,"div",23)(33,"div",24)(34,"table",25)(35,"thead",26)(36,"tr")(37,"th",27),t.EFF(38,"ID"),t.k0s(),t.j41(39,"th",28),t.EFF(40,"Nome"),t.k0s(),t.j41(41,"th",29),t.EFF(42,"Valor"),t.k0s(),t.j41(43,"th",30),t.EFF(44,"Dia Vencimento"),t.k0s(),t.j41(45,"th",29),t.EFF(46,"Categoria"),t.k0s(),t.j41(47,"th",31),t.EFF(48,"A\xe7\xf5es"),t.k0s()()(),t.j41(49,"tbody"),t.DNE(50,E,17,5,"tr",32),t.DNE(51,j,11,0,"tr",33),t.DNE(52,M,3,0,"tr",33),t.DNE(53,R,3,1,"tr",33),t.k0s(),t.DNE(54,$,7,1,"tfoot",33),t.k0s()()(),t.DNE(55,I,1,2,"app-conta-mensal-form",34),t.k0s()),2&a&&(t.R7$(1),t.Y8G("ngIf",n.alert.message),t.R7$(20),t.Y8G("value",n.q),t.R7$(4),t.Y8G("value",n.catFilter),t.R7$(3),t.Y8G("ngForOf",n.categories),t.R7$(3),t.Lme(" ",n.filtered.length," ",1===n.filtered.length?"conta":"contas"," "),t.R7$(19),t.Y8G("ngForOf",n.filtered),t.R7$(1),t.Y8G("ngIf",!n.loading&&0===n.filtered.length),t.R7$(1),t.Y8G("ngIf",n.loading),t.R7$(1),t.Y8G("ngIf",n.errorMsg),t.R7$(1),t.Y8G("ngIf",n.filtered.length>0),t.R7$(1),t.Y8G("ngIf",n.showModalForm))},dependencies:[m.Sq,m.bT,r.xH,r.y7,b]})}}return o})()}];let T=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[p.iI.forChild(N),p.iI]})}}return o})();var G=l(3887);let L=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[G.G,r.X1,T]})}}return o})()}}]);