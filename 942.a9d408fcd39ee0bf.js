"use strict";(self.webpackChunkmy_finance_front=self.webpackChunkmy_finance_front||[]).push([[942],{5942:(G,u,c)=>{c.r(u),c.d(u,{BancoModule:()=>$});var d=c(177),i=c(4341),p=c(9032),m=c(467),t=c(540),f=c(1259),v=c(5403);function b(a,r){1&a&&(t.j41(0,"div",19),t.EFF(1," Informe um nome v\xe1lido. "),t.k0s())}function h(a,r){if(1&a&&(t.j41(0,"option",12),t.EFF(1),t.k0s()),2&a){const o=r.$implicit;t.Y8G("ngValue",o.id),t.R7$(1),t.SpI(" ",o.nomeTipoCartao," ")}}function F(a,r){1&a&&(t.j41(0,"div",19),t.EFF(1," Selecione um tipo de cart\xe3o. "),t.k0s())}function g(a,r){1&a&&(t.j41(0,"div",19),t.EFF(1," Informe um valor. "),t.k0s())}let k=(()=>{class a{constructor(o,n){this.fb=o,this.bancoService=n,this.banco=null,this.tiposCartao=[],this.closed=new t.bkB,this.saving=!1,this.form=this.fb.group({nomeBanco:["",[i.k0.required,i.k0.minLength(2)]],saldoInicial:[0,[i.k0.required]],ativo:[!0,[i.k0.required]],tipoCartaoId:[null,[i.k0.required]]})}ngOnInit(){this.banco&&this.form.patchValue({nomeBanco:this.banco.nomeBanco,saldoInicial:this.banco.saldoInicial,ativo:this.banco.ativo,tipoCartaoId:this.banco.tipoCartaoId??null})}close(o=!1){this.closed.emit(o)}save(){var o=this;return(0,m.A)(function*(){if(o.form.invalid)o.form.markAllAsTouched();else try{o.saving=!0;const n={id:o.banco?.id||0,nomeBanco:o.form.value.nomeBanco,saldoInicial:Number(o.form.value.saldoInicial)||0,tipoCartaoId:Number(o.form.value.tipoCartaoId),ativo:!!o.form.value.ativo};o.banco?yield o.bancoService.update(n):yield o.bancoService.create(n),o.close(!0)}catch{alert("Erro ao salvar banco.")}finally{o.saving=!1}})()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(i.ok),t.rXU(f.J))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-banco-form"]],inputs:{banco:"banco",tiposCartao:"tiposCartao"},outputs:{closed:"closed"},decls:39,vars:17,consts:[[1,"modal-backdrop-custom",3,"click"],["role","dialog","aria-modal","true",1,"modal-custom"],[1,"modal-card","card"],[1,"card-header"],[1,"card-title","m-0"],["type","button","aria-label","Fechar",1,"btn-close",3,"click"],[1,"card-body",3,"formGroup"],[1,"mb-3"],[1,"form-label"],["formControlName","nomeBanco",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["formControlName","tipoCartaoId",1,"form-select"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","formControlName","saldoInicial",1,"form-control"],["formControlName","ativo",1,"form-select"],[1,"card-footer","d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"invalid-feedback"]],template:function(n,e){1&n&&(t.j41(0,"div",0),t.bIt("click",function(){return e.close(!1)}),t.k0s(),t.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),t.EFF(5),t.k0s(),t.j41(6,"button",5),t.bIt("click",function(){return e.close(!1)}),t.k0s()(),t.j41(7,"div",6)(8,"div",7)(9,"label",8),t.EFF(10,"Nome Banco"),t.k0s(),t.nrm(11,"input",9),t.DNE(12,b,2,0,"div",10),t.k0s(),t.j41(13,"div",7)(14,"label",8),t.EFF(15,"Tipo Cart\xe3o"),t.k0s(),t.j41(16,"select",11)(17,"option",12),t.EFF(18,"Selecione..."),t.k0s(),t.DNE(19,h,2,2,"option",13),t.k0s(),t.DNE(20,F,2,0,"div",10),t.k0s(),t.j41(21,"div",7)(22,"label",8),t.EFF(23,"Saldo Inicial"),t.k0s(),t.nrm(24,"input",14),t.DNE(25,g,2,0,"div",10),t.k0s(),t.j41(26,"div",7)(27,"label",8),t.EFF(28,"Status"),t.k0s(),t.j41(29,"select",15)(30,"option",12),t.EFF(31,"Ativo"),t.k0s(),t.j41(32,"option",12),t.EFF(33,"Inativo"),t.k0s()()()(),t.j41(34,"div",16)(35,"button",17),t.bIt("click",function(){return e.close(!1)}),t.EFF(36,"Cancelar"),t.k0s(),t.j41(37,"button",18),t.bIt("click",function(){return e.save()}),t.EFF(38),t.k0s()()()()),2&n&&(t.R7$(5),t.JRh(e.banco?"Editar Banco":"Novo Banco"),t.R7$(2),t.Y8G("formGroup",e.form),t.R7$(4),t.AVh("is-invalid",e.form.controls.nomeBanco.touched&&e.form.controls.nomeBanco.invalid),t.R7$(1),t.Y8G("ngIf",e.form.controls.nomeBanco.touched&&e.form.controls.nomeBanco.invalid),t.R7$(4),t.AVh("is-invalid",e.form.controls.tipoCartaoId.touched&&e.form.controls.tipoCartaoId.invalid),t.R7$(1),t.Y8G("ngValue",null),t.R7$(2),t.Y8G("ngForOf",e.tiposCartao),t.R7$(1),t.Y8G("ngIf",e.form.controls.tipoCartaoId.touched&&e.form.controls.tipoCartaoId.invalid),t.R7$(4),t.AVh("is-invalid",e.form.controls.saldoInicial.touched&&e.form.controls.saldoInicial.invalid),t.R7$(1),t.Y8G("ngIf",e.form.controls.saldoInicial.touched&&e.form.controls.saldoInicial.invalid),t.R7$(5),t.Y8G("ngValue",!0),t.R7$(2),t.Y8G("ngValue",!1),t.R7$(5),t.Y8G("disabled",e.saving),t.R7$(1),t.SpI(" ",e.saving?"Salvando...":"Salvar"," "))},dependencies:[d.Sq,d.bT,i.xH,i.y7,i.me,i.Q0,i.wz,i.BC,i.cb,i.j4,i.JD],styles:[".modal-backdrop-custom[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:3000}.modal-custom[_ngcontent-%COMP%]{position:fixed;inset:0;display:grid;place-items:center;z-index:3001;padding:16px}.modal-card[_ngcontent-%COMP%]{width:100%;max-width:760px}"]})}}return a})();function _(a,r){if(1&a&&(t.j41(0,"div",42),t.EFF(1),t.k0s()),2&a){const o=t.XpG();t.AVh("alert-success","success"===o.alert.type)("alert-danger","error"===o.alert.type),t.R7$(1),t.SpI(" ",o.alert.message," ")}}function C(a,r){if(1&a){const o=t.RV6();t.j41(0,"tr")(1,"td",43),t.EFF(2),t.k0s(),t.j41(3,"td",44),t.EFF(4),t.k0s(),t.j41(5,"td",44),t.EFF(6),t.k0s(),t.j41(7,"td")(8,"span"),t.EFF(9),t.k0s()(),t.j41(10,"td",45)(11,"div",46)(12,"button",47),t.bIt("click",function(){const s=t.eBV(o).$implicit,l=t.XpG();return t.Njj(l.openEdit(s))}),t.EFF(13," \u270f\ufe0f "),t.k0s(),t.j41(14,"button",48),t.bIt("click",function(){const s=t.eBV(o).$implicit,l=t.XpG();return t.Njj(l.onDelete(s))}),t.EFF(15," \u{1f5d1}\ufe0f "),t.k0s()()()()}if(2&a){const o=r.$implicit,n=t.XpG();t.R7$(2),t.JRh(o.id),t.R7$(2),t.JRh(o.nomeBanco),t.R7$(2),t.JRh(n.formatMoney(o.saldoInicial)),t.R7$(2),t.HbH(n.badgeClass(o.ativo)),t.R7$(1),t.JRh(o.ativo?"Ativo":"Inativo")}}function y(a,r){1&a&&(t.j41(0,"tr")(1,"td",49),t.EFF(2," Nenhum banco encontrado. "),t.k0s()())}function E(a,r){1&a&&(t.j41(0,"tr")(1,"td",49),t.EFF(2,"Carregando..."),t.k0s()())}function I(a,r){if(1&a&&(t.j41(0,"tr")(1,"td",50),t.EFF(2),t.k0s()()),2&a){const o=t.XpG();t.R7$(2),t.JRh(o.errorMsg)}}function j(a,r){if(1&a){const o=t.RV6();t.j41(0,"app-banco-form",51),t.bIt("closed",function(e){t.eBV(o);const s=t.XpG();return t.Njj(s.closeModal(e))}),t.k0s()}if(2&a){const o=t.XpG();t.Y8G("banco",o.editing)("tiposCartao",o.tiposCartao)}}const B=[{path:"",component:(()=>{class a{constructor(o,n){this.bancoService=o,this.tipoCartaoService=n,this.bancos=[],this.filtered=[],this.tiposCartao=[],this.loading=!1,this.errorMsg="",this.q="",this.statusFilter="ALL",this.alert={type:"",message:""},this.showModal=!1,this.editing=null,this.totalGeral=0,this.totalAtivo=0,this.totalInativo=0}ngOnInit(){var o=this;return(0,m.A)(function*(){yield o.load()})()}load(){var o=this;return(0,m.A)(function*(){try{o.loading=!0,o.errorMsg="";const[n,e]=yield Promise.all([o.bancoService.list(),o.tipoCartaoService.list()]);o.bancos=n??[],o.tiposCartao=e??[],o.applyFilters()}catch(n){o.errorMsg=n?.message??"Erro ao carregar bancos."}finally{o.loading=!1}})()}applyFilters(){const o=this.q.trim().toLowerCase();this.filtered=[...this.bancos].sort((n,e)=>(n.nomeBanco??"").localeCompare(e.nomeBanco??"")).filter(n=>"ALL"===this.statusFilter||(n.ativo?"Ativo":"Inativo")===this.statusFilter).filter(n=>!o||(n.nomeBanco??"").toLowerCase().includes(o)||String(n.id).includes(o)),this.calcSummary()}calcSummary(){let o=0,n=0,e=0;for(const s of this.bancos){const l=Number(s.saldoInicial)||0;o+=l,s.ativo?n+=l:e+=l}this.totalGeral=o,this.totalAtivo=n,this.totalInativo=e}onSearchChange(o){this.q=o,this.applyFilters()}onStatusChange(o){this.statusFilter=o,this.applyFilters()}openCreate(){this.editing=null,this.showModal=!0}openEdit(o){this.editing=o,this.showModal=!0}closeModal(o){this.showModal=!1,this.editing=null,o&&this.load()}onDelete(o){var n=this;return(0,m.A)(function*(){if(window.confirm(`Excluir o banco "${o.nomeBanco}"?`))try{yield n.bancoService.delete(o.id),n.alert={type:"success",message:"Banco deletado com sucesso!"},setTimeout(()=>n.alert={type:"",message:""},3e3),yield n.load()}catch{n.alert={type:"error",message:"Falha ao deletar. O banco pode estar vinculado a transa\xe7\xf5es."},setTimeout(()=>n.alert={type:"",message:""},12e3)}})()}badgeClass(o){return o?"badge bg-success-lt":"badge bg-secondary-lt"}formatMoney(o){const n=Number(o)||0;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(f.J),t.rXU(v.g))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-banco-list"]],decls:78,vars:13,consts:[[1,"container-xl","py-3"],["class","alert",3,"alert-success","alert-danger",4,"ngIf"],[1,"page-header","d-print-none","mb-3"],[1,"row","align-items-center"],[1,"col"],[1,"page-pretitle"],[1,"page-title"],[1,"col-auto","ms-auto","d-print-none"],[1,"btn-list"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","row-cards","mb-4"],[1,"col-12","col-md-4"],[1,"card","card-sm","bg-azure-lt"],[1,"card-body"],[1,"font-weight-medium"],[1,"text-secondary"],[1,"card","card-sm","bg-success-lt"],[1,"text-success"],[1,"card","card-sm","bg-secondary-lt"],[1,"card","mb-3"],[1,"row","g-2","align-items-end"],[1,"col-12","col-md-6"],[1,"form-label"],["placeholder","Nome ou ID",1,"form-control",3,"value","input"],[1,"col-12","col-md-3"],[1,"form-select",3,"value","change"],["value","ALL"],["value","Ativo"],["value","Inativo"],[1,"col-12","col-md-3","d-flex","justify-content-md-end"],[1,"text-muted","small","mt-3","mt-md-0"],[1,"card"],[1,"table-responsive"],[1,"table","card-table","table-vcenter","table-hover"],[1,"bg-body-tertiary"],[1,"w-1"],[1,"text-nowrap"],[1,"w-1","text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"banco","tiposCartao","closed",4,"ngIf"],[1,"alert"],[1,"text-muted"],[1,"fw-medium"],[1,"text-center"],[1,"btn-list","d-inline-flex"],["type","button","title","Editar",1,"btn","btn-icon","btn-soft-secondary",3,"click"],["type","button","title","Excluir",1,"btn","btn-icon","btn-soft-danger",3,"click"],["colspan","5",1,"text-center","text-secondary","py-4"],["colspan","5",1,"text-center","text-danger","py-4"],[3,"banco","tiposCartao","closed"]],template:function(n,e){1&n&&(t.j41(0,"div",0),t.DNE(1,_,2,5,"div",1),t.j41(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.EFF(6,"Cadastros"),t.k0s(),t.j41(7,"h2",6),t.EFF(8,"Bancos"),t.k0s()(),t.j41(9,"div",7)(10,"div",8)(11,"button",9),t.bIt("click",function(){return e.load()}),t.EFF(12," Atualizar "),t.k0s(),t.j41(13,"button",10),t.bIt("click",function(){return e.openCreate()}),t.EFF(14," + Novo banco "),t.k0s()()()()(),t.j41(15,"div",11)(16,"div",12)(17,"div",13)(18,"div",14)(19,"div",15),t.EFF(20,"Saldo Total (Todos)"),t.k0s(),t.j41(21,"div",16),t.EFF(22),t.k0s()()()(),t.j41(23,"div",12)(24,"div",17)(25,"div",14)(26,"div",15),t.EFF(27,"Saldo de Bancos Ativos"),t.k0s(),t.j41(28,"div",18),t.EFF(29),t.k0s()()()(),t.j41(30,"div",12)(31,"div",19)(32,"div",14)(33,"div",15),t.EFF(34,"Saldo de Bancos Inativos"),t.k0s(),t.j41(35,"div",16),t.EFF(36),t.k0s()()()()(),t.j41(37,"div",20)(38,"div",14)(39,"div",21)(40,"div",22)(41,"label",23),t.EFF(42,"Buscar"),t.k0s(),t.j41(43,"input",24),t.bIt("input",function(l){return e.onSearchChange(l.target.value)}),t.k0s()(),t.j41(44,"div",25)(45,"label",23),t.EFF(46,"Status"),t.k0s(),t.j41(47,"select",26),t.bIt("change",function(l){return e.onStatusChange(l.target.value)}),t.j41(48,"option",27),t.EFF(49,"Todos"),t.k0s(),t.j41(50,"option",28),t.EFF(51,"Ativo"),t.k0s(),t.j41(52,"option",29),t.EFF(53,"Inativo"),t.k0s()()(),t.j41(54,"div",30)(55,"div",31),t.EFF(56),t.k0s()()()()(),t.j41(57,"div",32)(58,"div",33)(59,"table",34)(60,"thead",35)(61,"tr")(62,"th",36),t.EFF(63,"ID"),t.k0s(),t.j41(64,"th",37),t.EFF(65,"Nome Banco"),t.k0s(),t.j41(66,"th",37),t.EFF(67,"Saldo Inicial"),t.k0s(),t.j41(68,"th",37),t.EFF(69,"Status"),t.k0s(),t.j41(70,"th",38),t.EFF(71,"A\xe7\xf5es"),t.k0s()()(),t.j41(72,"tbody"),t.DNE(73,C,16,6,"tr",39),t.DNE(74,y,3,0,"tr",40),t.DNE(75,E,3,0,"tr",40),t.DNE(76,I,3,1,"tr",40),t.k0s()()()(),t.DNE(77,j,1,2,"app-banco-form",41),t.k0s()),2&n&&(t.R7$(1),t.Y8G("ngIf",e.alert.message),t.R7$(21),t.JRh(e.formatMoney(e.totalGeral)),t.R7$(7),t.JRh(e.formatMoney(e.totalAtivo)),t.R7$(7),t.JRh(e.formatMoney(e.totalInativo)),t.R7$(7),t.Y8G("value",e.q),t.R7$(4),t.Y8G("value",e.statusFilter),t.R7$(9),t.Lme(" ",e.filtered.length," ",1===e.filtered.length?"banco":"bancos"," "),t.R7$(17),t.Y8G("ngForOf",e.filtered),t.R7$(1),t.Y8G("ngIf",!e.loading&&0===e.filtered.length),t.R7$(1),t.Y8G("ngIf",e.loading),t.R7$(1),t.Y8G("ngIf",e.errorMsg),t.R7$(1),t.Y8G("ngIf",e.showModal))},dependencies:[d.Sq,d.bT,i.xH,i.y7,k]})}}return a})()}];let R=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[p.iI.forChild(B),p.iI]})}}return a})(),$=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[d.MD,i.X1,R]})}}return a})()}}]);